---
layout: post
title: '消息中间件（一）'
subtitle: '分布式消息中间件设计'
date: 2022-02-19
categories: mq
cover: 'http://on2171g4d.bkt.clouddn.com/jekyll-theme-h2o-postcover.jpg'
tags: mq 
---



# 分布式消息中间件设计

### 1. 分布式消息中间件

**单体应用：**所有功能结合在同一个工程系统内

**分布式系统架构：**将一个系统按照业务模块拆分（拆分原则？？）为多个独立的子系统

**优点:**

1. 业务模块相应独立，某个业务模块升级，不用升级整个系统
2. 开发方便，不需要将代码合并
3. 如果某一个业务模块压力大，只需要对该业务模块单独进行水平扩展，可以充分利用资源

**缺点：**

1. 系统之间交互，需通过rpc、rest、mq来实现，这样系统间还是有较强的耦合度
2. 当某一个业务大时，还是会出现业务系统崩溃的情况

**消息中间件**

1. 利用高效可靠的消息传递机制进行平台无关的数据交流
2. 基于数据通信来进行分布式系统的集成
3. 通过提供消息传递和消息排队模型，他可以分布式系统环境下扩展进程间的通信

**应用场景**

跨系统数据传递、高并发流量削峰、数据 异步处理、分布式事务。。。等等

**常见的消息中间件**

ActiveMQ、RabbitMQ、Kafka、RocketMQ

**消息中间件核心设计**

**本质**

一种具备接收请求、保存数据、发送数据等功能的网络应用。和一般网络应用程序的区别是它主要负责数据的接收和传递，所以性能一般高于普通程序

**五大核心组成**

- 协议
- 持久化机制
- 消息分发机制
- 高可用设计
- 高可靠设计

### 2.协议

协议是计算机之间通信时共同遵守的一组约定，都遵守相同的约定，计算机之间才能相互交流。是对**数据格式**和计算机之间**交换数据**时必须遵守的规则的正式描述。

协议三要素：语法、语义、时序

**消息中间件常用协议**

- **AMQP(Advanced Message Queuing Protocal)**
  
    高级消息队列协议，04年JPMorgan Chase联合其他公司共同设计
    
    **特性**：事务支持、持久化支持，出生金融行业，在可靠性消息处理上具备天然优势
    
    **代表：RabbitMQ**
    
- **MQTT(Message Queuing Telemetry Transport)**
  
     消息队列遥测传输，IBM开发的一个即时通讯协议，物联网系统架构的重要组成部分
     
    **特性：**轻量、结构简单、传输快、没有事务支持、没有持久化相关设计
    
    **应用场景：**适用于计算能力有限、低带宽、网络不稳定的场景
    
    **代表：RabbitMQ**
    
- **Kafka**
  
    基于TCP的二进制协议。消息内部通过长度来分隔，由一些基本数据类型组成。
    
    **特性：**结构简单、解析快、无事务设计、有持久化设计
    
- **OpenMessage**
  
    阿里、雅虎、滴滴出行、Streamlio等公司共同参与创立的分布式消息中间件、流处理领域的应用开发标准，是国内首个在全球范围内发起的分布式消息领域国际标准。
    
    **特性：**结构简单、解析快、有事务设计、有持久化设计
    
    **代表：Apache RocketMQ**
    

### 3. 持久化

数据存入磁盘，而不是存在内存中随服务重启而消失，使数据能够永久保存

|  | ActiveMQ | RabbitMQ | Kafka | RocketMQ |
| --- | --- | --- | --- | --- |
| 文件系统 | 支持 | 支持 | 支持 | 支持 |
| 数据库 | 支持 | / | / | / |

### 4. 消息分发

|  | ActiveMQ | RabbitMQ | Kafka | RocketMQ |
| --- | --- | --- | --- | --- |
| 发布订阅 | 支持 | 支持 | 支持 | 支持 |
| 轮询分发 | 支持 | 支持 | 支持 | / |
| 公平分发 | / | 支持 | 支持 | / |
| 重发 | 支持 | 支持 | / | 支持 |
| 消息拉取 | / | 支持 | 支持 | 支持 |

### 5. 高可用

产品在规定的条件和规定的时刻或者时间区间内处于可执行规定功能状态的能力。当业务量大时，一台消息中间件服务器可能无法满足需求，所以需要消息中间件能够集群部署，来达到高可用的目的。

1. Master-Slave 
2. Broker-Cluster
3. 两者结合

### 6. 高可靠

指系统可以无故障地持续运行。比如一个系统从来不崩溃、保存，或者崩溃、保存的几率较低

在高并发的业务场景下，如果不能保证系统的高可靠，造成的损失将十分验证

<aside>
📚 消息中间件的高可靠性如何保证？
1. **消息传输可靠**：通过协议来保证系统间新数据解析的正确性
2. **消息存储可靠**：通过持久化来保证消息的存储可靠性
</aside>