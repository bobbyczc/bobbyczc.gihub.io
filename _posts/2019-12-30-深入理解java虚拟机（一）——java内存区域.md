---
layout: post
title: '深入理解java虚拟机（一）--java内存区域'
subtitle: 'java内存区域'
date: 2019-12-30
categories: jvm
cover: 'http://on2171g4d.bkt.clouddn.com/jekyll-theme-h2o-postcover.jpg'
tags: jvm
---

> 本系列文章来自《深入理解java虚拟机》第二版的阅读理解整理

#  Java内存区域

熟悉java的都知道，Java最方便的地方就是开发者不需要自己进行内存的清理，这些东西都由“垃圾收集器”来完成，但是并非所有问题垃圾收集器都能为我们解决，一旦出现了内存泄漏或者内存溢出的问题，如果不了解虚拟机是怎么使用内存的， 那么排查问题就会变得很艰难。

## 1、运行时数据区域

![java内存区域](https://upload-images.jianshu.io/upload_images/4222138-4f353dd454f2192a.png?imageMogr2/auto-orient/strip|imageView2/2/w/549/format/webp)

### 1.1 程序计数器

​	程序计数器是一块较小的内存空间，可以看做是当前线程所执行的字节码的行号指示器，字节码解释器通过这个值来选取下一条需要执行的指令位置。程序计数器是**线程私有的**，每个线程都有自己独立的程序计数器。

### 1.2 java虚拟机栈

​	虚拟机栈也是**线程私有**的，描述了线程内Java方法执行的内存模型。每个方法在执行的过程都会创建一个栈帧，栈帧里存储了**局部变量，操作数栈，动态链接，方法出口等**信息，调用方法到方法结束的过程，也就是栈帧入栈到出栈的过程。

​	虚拟机栈中存储了方法中的局部变量表，这个局部变量表是编译器可知的（即所需的内存空间是在编译期就可以完成分配的），存放了各种基本数据类型，对象引用（指向对象起始地址的指针或者一个代表对象的句柄）和returnAddress类型（指向一条字节码指令的地址）

### 1.3 本地方法栈

​	此区域与虚拟机栈作用类似，不同之处在于，虚拟机栈是为java方法（字节码）服务，本地方法栈是为虚拟机使用到的native方法服务的

### 1.4 Java堆

​	Java堆是虚拟机所管理的内存中最大的一块，被所有线程共享的一块内存区域，在虚拟机启动时创建。Java堆的唯一目的就是**存放对象实例**，几乎所有的对象实例都在这里分配内存。由于在程序运行期间，总会有大量的对象产生或者销毁，因此堆是垃圾收集器管理的主要区域（被称为GC堆）

### 1.5 方法区

​	方法区也是**线程共享**的，用于存储**已被虚拟机加载的类信息、常量、静态变量、即时编译器编译后的代码**等数据。垃圾回收行为在这部分区域比较少出现，这个区域的内存回收目标主要是针对常量池的回收和对类型的卸载。

​	Class文件中除了有类的版本、字段、方法、接口等信息外，还有一项信息是常量池，这里的常量池的静态的，是用于存放文件中定义，在编译期生成的各种字面量以及符号引用。这部分内容在类加载后会被放入方法区的**运行时常量池** ；

​	**运行时常量池** 也在方法区中，并非class文件中预先定义好的常量才会存入这个区域，运行期间也能有新的常量放入这个动态常量池里，尽管这个特性并不常用，但String的intern()方法确实使用了这个特性。

### 1.6 直接内存

​	直接内存并不是虚拟机运行时数据区的一部分，也不是Java虚拟机规范中定义的内存区域进度款jdk1.4引入的NIO类，可以通过Channel与缓冲区的方式直接调用堆外内存，因此也可能导致OutOfMemoryError出现。